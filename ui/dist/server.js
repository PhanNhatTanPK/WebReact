(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("dotenv");var n=e.n(t);const s=require("express");var a=e.n(s);const o=require("http-proxy-middleware");var i=e.n(o);const r=require("source-map-support");var l=e.n(r);const c=require("react");var u=e.n(c);const h=require("react-dom/server");var d=e.n(h);const m=require("react-router-dom"),p=require("react-bootstrap"),E=require("react-router-bootstrap"),g=require("url-search-params");var f=e.n(g);class C extends u().Component{constructor({location:{search:e}}){super();const t=new(f())(e);this.state={status:t.get("status")||"",effortMin:t.get("effortMin")||"",effortMax:t.get("effortMax")||"",changed:!1},this.onChangeStatus=this.onChangeStatus.bind(this),this.onChangeEffortMin=this.onChangeEffortMin.bind(this),this.onChangeEffortMax=this.onChangeEffortMax.bind(this),this.applyFilter=this.applyFilter.bind(this),this.showOriginalFilter=this.showOriginalFilter.bind(this)}componentDidUpdate(e){const{location:{search:t}}=e,{location:{search:n}}=this.props;t!==n&&this.showOriginalFilter()}onChangeStatus(e){this.setState({status:e.target.value,changed:!0})}onChangeEffortMin(e){e.target.value.match(/^\d*$/)&&this.setState({effortMin:e.target.value,changed:!0})}onChangeEffortMax(e){e.target.value.match(/^\d*$/)&&this.setState({effortMax:e.target.value,changed:!0})}showOriginalFilter(){const{location:{search:e}}=this.props,t=new(f())(e);this.setState({status:t.get("status")||"",effortMin:t.get("effortMin")||"",effortMax:t.get("effortMax")||"",changed:!1})}applyFilter(){const{status:e,effortMin:t,effortMax:n}=this.state,{history:s,urlBase:a}=this.props,o=new(f());e&&o.set("status",e),t&&o.set("effortMin",t),n&&o.set("effortMax",n);const i=o.toString()?`?${o.toString()}`:"";s.push({pathname:a,search:i})}render(){const{status:e,changed:t}=this.state,{effortMin:n,effortMax:s}=this.state;return u().createElement(p.Row,null,u().createElement(p.Col,{xs:6,sm:4,md:3,lg:2},u().createElement(p.FormGroup,null,u().createElement(p.ControlLabel,null,"Status:"),u().createElement(p.FormControl,{componentClass:"select",value:e,onChange:this.onChangeStatus},u().createElement("option",{value:""},"(All)"),u().createElement("option",{value:"New"},"New"),u().createElement("option",{value:"Assigned"},"Assigned"),u().createElement("option",{value:"Fixed"},"Fixed"),u().createElement("option",{value:"Closed"},"Closed")))),u().createElement(p.Col,{xs:6,sm:4,md:3,lg:2},u().createElement(p.FormGroup,null,u().createElement(p.ControlLabel,null,"Effort between:"),u().createElement(p.InputGroup,null,u().createElement(p.FormControl,{value:n,onChange:this.onChangeEffortMin}),u().createElement(p.InputGroup.Addon,null,"-"),u().createElement(p.FormControl,{value:s,onChange:this.onChangeEffortMax})))),u().createElement(p.Col,{xs:6,sm:4,md:3,lg:2},u().createElement(p.FormGroup,null,u().createElement(p.ControlLabel,null,"Â "),u().createElement(p.ButtonToolbar,null,u().createElement(p.Button,{bsStyle:"primary",type:"button",onClick:this.applyFilter},"Apply"),u().createElement(p.Button,{type:"button",onClick:this.showOriginalFilter,disabled:!t},"Reset")))))}}const b=(0,m.withRouter)(C),v=u().createContext({signedIn:!1});class w extends u().Component{render(){const{issue:e,location:{search:t},closeIssue:n,deleteIssue:s,index:a}=this.props,o=!this.context.signedIn,i={pathname:`/issues/${e.id}`,search:t},r=u().createElement(p.Tooltip,{id:"close-tooltip",placement:"top"},"Edit Issue"),l=u().createElement(p.Tooltip,{id:"close-tooltip",placement:"top"},"Close Issue"),c=u().createElement(p.Tooltip,{id:"delete-tooltip",placement:"top"},"Delete Issue"),h=u().createElement("tr",null,u().createElement("td",null,e.id),u().createElement("td",null,e.status),u().createElement("td",null,e.owner),u().createElement("td",null,e.created.toDateString()),u().createElement("td",null,e.effort),u().createElement("td",null,e.due?e.due.toDateString():""),u().createElement("td",null,e.title),u().createElement("td",null,u().createElement(E.LinkContainer,{to:`/edit/${e.id}`},u().createElement(p.OverlayTrigger,{delayShow:1e3,overlay:r},u().createElement(p.Button,{bsSize:"xsmall"},u().createElement(p.Glyphicon,{glyph:"pencil"}))))," ",u().createElement(p.OverlayTrigger,{delayShow:1e3,overlay:l},u().createElement(p.Button,{disabled:o,bsSize:"xsmall",onClick:function(e){e.preventDefault(),n(a)}},u().createElement(p.Glyphicon,{glyph:"envelope"})))," ",u().createElement(p.OverlayTrigger,{delayShow:1e3,overlay:c},u().createElement(p.Button,{disabled:o,bsSize:"xsmall",onClick:function(e){e.preventDefault(),s(a)}},u().createElement(p.Glyphicon,{glyph:"minus"})))));return u().createElement(E.LinkContainer,{to:i},h)}}w.contextType=v;const y=(0,m.withRouter)(w);function I({issues:e,closeIssue:t,deleteIssue:n}){const s=e.map(((e,s)=>u().createElement(y,{key:e.id,issue:e,closeIssue:t,deleteIssue:n,index:s})));return u().createElement(p.Table,{bordered:!0,condensed:!0,hover:!0,responsive:!0},u().createElement("thead",null,u().createElement("tr",null,u().createElement("th",null,"ID"),u().createElement("th",null,"Status"),u().createElement("th",null,"Owner"),u().createElement("th",null,"Created"),u().createElement("th",null,"Effort"),u().createElement("th",null,"Due Date"),u().createElement("th",null,"Title"),u().createElement("th",null,"Action"))),u().createElement("tbody",null,s))}function S({issue:e}){return e?u().createElement("div",null,u().createElement("h3",null,"Description"),u().createElement("pre",null,e.description)):null}delete y.contextType;const D=require("isomorphic-fetch");var N=e.n(D);const M=new RegExp("^\\d\\d\\d\\d-\\d\\d-\\d\\d");function T(e,t){return M.test(t)?new Date(t):t}async function O(e,t={},n=null,s=null){const a=process.env.UI_SERVER_API_ENDPOINT;try{const o={"Content-Type":"application/json"};s&&(o.Cookie=s);const i=await N()(a,{method:"POST",credentials:"include",headers:o,body:JSON.stringify({query:e,variables:t})}),r=await i.text(),l=JSON.parse(r,T);if(l.errors){const e=l.errors[0];if("BAD_USER_INPUT"===e.extensions.code){const t=e.extensions.exception.errors.join("\n ");n&&n(`${e.message}:\n ${t}`)}else n&&n(`${e.extensions.code}: ${e.message}`)}return l.data}catch(e){return n&&n(`Error in sending data to server: ${e.message}`),null}}class x extends u().Component{componentDidUpdate(){const{showing:e,onDismiss:t}=this.props;e&&(clearTimeout(this.dismissTimer),this.dismissTimer=setTimeout(t,5e3))}componentWillUnmount(){clearTimeout(this.dismissTimer)}render(){const{showing:e,bsStyle:t,onDismiss:n,children:s}=this.props;return u().createElement(p.Collapse,{in:e},u().createElement("div",{style:{position:"fixed",bottom:20,left:20,zIndex:10}},u().createElement(p.Alert,{bsStyle:t,onDismiss:n},s)))}}function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},F.apply(this,arguments)}function _(e){return class extends u().Component{constructor(e){super(e),this.state={toastVisible:!1,toastMessage:"",toastType:"success"},this.showSuccess=this.showSuccess.bind(this),this.showError=this.showError.bind(this),this.dismissToast=this.dismissToast.bind(this)}showSuccess(e){this.setState({toastVisible:!0,toastMessage:e,toastType:"success"})}showError(e){this.setState({toastVisible:!0,toastMessage:e,toastType:"danger"})}dismissToast(){this.setState({toastVisible:!1})}render(){const{toastType:t,toastVisible:n,toastMessage:s}=this.state;return u().createElement(u().Fragment,null,u().createElement(e,F({showError:this.showError,showSuccess:this.showSuccess,dismissToast:this.dismissToast},this.props)),u().createElement(x,{bsStyle:t,showing:n,onDismiss:this.dismissToast},s))}}}const P={};function $({params:e,page:t,activePage:n,children:s}){return e.set("page",t),0===t?u().cloneElement(s,{disabled:!0}):u().createElement(E.LinkContainer,{isActive:()=>t===n,to:{search:`?${e.toString()}`}},s)}class k extends u().Component{static async fetchData(e,t,n){const s=new(f())(t),a={hasSelection:!1,selectedId:0};s.get("status")&&(a.status=s.get("status"));const o=parseInt(s.get("effortMin"),10);Number.isNaN(o)||(a.effortMin=o);const i=parseInt(s.get("effortMax"),10);Number.isNaN(i)||(a.effortMax=i);const{params:{id:r}}=e,l=parseInt(r,10);Number.isNaN(l)||(a.hasSelection=!0,a.selectedId=l);let c=parseInt(s.get("page"),10);return Number.isNaN(c)&&(c=1),a.page=c,await O("query issueList(\n      $status: StatusType\n      $effortMin: Int\n      $effortMax: Int\n      $hasSelection: Boolean!\n      $selectedId: Int!\n      $page: Int\n    ) {\n      issueList(\n        status: $status\n        effortMin: $effortMin\n        effortMax: $effortMax\n        page: $page\n      ) {\n        issues {\n          id title status owner\n          created effort due\n        }\n        pages\n      }\n      issue(id: $selectedId) @include (if : $hasSelection) {\n        id description\n      }\n    }",a,n)}constructor(){super();const e=P.initialData||{issueList:{}},{issueList:{issues:t,pages:n},issue:s}=e;delete P.initialData,this.state={issues:t,selectedIssue:s,pages:n},this.closeIssue=this.closeIssue.bind(this),this.deleteIssue=this.deleteIssue.bind(this)}componentDidMount(){const{issues:e}=this.state;null==e&&this.loadData()}componentDidUpdate(e){const{location:{search:t},match:{params:{id:n}}}=e,{location:{search:s},match:{params:{id:a}}}=this.props;t===s&&n===a||this.loadData()}async loadData(){const{location:{search:e},match:t,showError:n}=this.props,s=await k.fetchData(t,e,n);s&&this.setState({issues:s.issueList.issues,selectedIssue:s.issue,pages:s.issueList.pages})}async closeIssue(e){const{issues:t}=this.state,{showError:n}=this.props,s=await O("mutation issueClose($id: Int!) {\n      issueUpdate(id: $id, changes: { status: Closed }) {\n        id title status owner\n        effort created due description\n      }\n    }",{id:t[e].id},n);s?this.setState((t=>{const n=[...t.issues];return n[e]=s.issueUpdate,{issues:n}})):this.loadData()}async deleteIssue(e){const{issues:t}=this.state,{location:{pathname:n,search:s},history:a}=this.props,{showSuccess:o,showError:i}=this.props,{id:r}=t[e],l=await O("mutation issueDelete($id: Int!) {\n      issueDelete(id: $id)\n    }",{id:r},i);l&&l.issueDelete?(this.setState((t=>{const o=[...t.issues];return n===`/issues/${r}`&&a.push({pathname:"/issues",search:s}),o.splice(e,1),{issues:o}})),o(u().createElement("span",null,`Deleted issue ${r} successfully.`,u().createElement(p.Button,{bsStyle:"link",onClick:()=>this.restoreIssue(r)},"UNDO")))):this.loadData()}async restoreIssue(e){const{showSuccess:t,showError:n}=this.props;await O("mutation issueRestore($id: Int!) {\n      issueRestore(id: $id)\n    }",{id:e},n)&&(t(`Issue ${e} restored successfully.`),this.loadData())}render(){const{issues:e}=this.state;if(null==e)return null;const{selectedIssue:t,pages:n}=this.state,{location:{search:s}}=this.props,a=new(f())(s);let o=parseInt(a.get("page"),10);Number.isNaN(o)&&(o=1);const i=5*Math.floor((o-1)/5)+1,r=i+5-1,l=1===i?0:i-5,c=r>=n?0:i+5,h=[];for(let e=i;e<=Math.min(r,n);e+=1)a.set("page",e),h.push(u().createElement($,{key:e,params:a,activePage:o,page:e},u().createElement(p.Pagination.Item,null,e)));return u().createElement(u().Fragment,null,u().createElement(p.Panel,null,u().createElement(p.Panel.Heading,null,u().createElement(p.Panel.Title,{toggle:!0},"Filter")),u().createElement(p.Panel.Body,{collapsible:!0},u().createElement(b,{urlBase:"/issues"}))),u().createElement(I,{issues:e,closeIssue:this.closeIssue,deleteIssue:this.deleteIssue}),u().createElement(S,{issue:t}),u().createElement(p.Pagination,null,u().createElement($,{params:a,page:l},u().createElement(p.Pagination.Item,null,"<")),h,u().createElement($,{params:a,page:c},u().createElement(p.Pagination.Item,null,">"))))}}const A=_(k);A.fetchData=k.fetchData;const U=A,L=["New","Assigned","Fixed","Closed"];class B extends u().Component{static async fetchData(e,t,n){const s=new URLSearchParams(t),a={};s.get("status")&&(a.status=s.get("status"));const o=parseInt(s.get("effortMin"),10);Number.isNaN(o)||(a.effortMin=o);const i=parseInt(s.get("effortMax"),10);return Number.isNaN(i)||(a.effortMax=i),await O("query issueList(\n      $status: StatusType\n      $effortMin: Int\n      $effortMax: Int\n    ) {\n      issueCounts(\n        status: $status\n        effortMin: $effortMin\n        effortMax: $effortMax\n      ) {\n        owner New Assigned Fixed Closed\n      }\n    }",a,n)}constructor(e){super(e);const t=P.initialData?P.initialData.issueCounts:null;delete P.initialData,this.state={stats:t}}componentDidMount(){const{stats:e}=this.state;null==e&&this.loadData()}componentDidUpdate(e){const{location:{search:t}}=e,{location:{search:n}}=this.props;t!==n&&this.loadData()}async loadData(){const{location:{search:e},match:t,showError:n}=this.props,s=await B.fetchData(t,e,n);s&&this.setState({stats:s.issueCounts})}render(){const{stats:e}=this.state;if(null==e)return null;const t=L.map((e=>u().createElement("th",{key:e},e))),n=e.map((e=>u().createElement("tr",{key:e.owner},u().createElement("td",null,e.owner),L.map((t=>u().createElement("td",{key:t},e[t]))),u().createElement("td",null,L.reduce(((t,n)=>t+e[n]),0)))));return u().createElement(u().Fragment,null,u().createElement(p.Panel,null,u().createElement(p.Panel.Heading,null,u().createElement(p.Panel.Title,{toggle:!0},"Filter")),u().createElement(p.Panel.Body,{collapsible:!0},u().createElement(b,{urlBase:"/report"}))),u().createElement(p.Table,{bordered:!0,condensed:!0,hover:!0,responsive:!0},u().createElement("thead",null,u().createElement("tr",null,u().createElement("th",null,"Owner"),t,u().createElement("th",null,"Total"))),u().createElement("tbody",null,n)))}}const G=_(B);G.fetchData=B.fetchData;const V=G;function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},R.apply(this,arguments)}class j extends u().Component{constructor(e){var t;super(e),this.state={value:(t=e.value,null!=t?t.toString():"")},this.onBlur=this.onBlur.bind(this),this.onChange=this.onChange.bind(this)}onChange(e){e.target.value.match(/^\d*$/)&&this.setState({value:e.target.value})}onBlur(e){const{onChange:t}=this.props,{value:n}=this.state;t(e,function(e){const t=parseInt(e,10);return Number.isNaN(t)?null:t}(n))}render(){const{value:e}=this.state;return u().createElement("input",R({type:"text"},this.props,{value:e,onBlur:this.onBlur,onChange:this.onChange}))}}function q(){return q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},q.apply(this,arguments)}class H extends u().Component{constructor(e){var t;super(e),this.state={value:(t=e.value,null!=t?t.toISOString().substr(0,10):""),focused:!1,valid:!0},this.onFocus=this.onFocus.bind(this),this.onBlur=this.onBlur.bind(this),this.onChange=this.onChange.bind(this)}onFocus(){this.setState({focused:!0})}onBlur(e){const{value:t,valid:n}=this.state,{onValidityChange:s,onChange:a}=this.props,o=function(e){const t=new Date(e);return Number.isNaN(t.getTime())?null:t}(t),i=""===t||null!=o;i!==n&&s&&s(e,i),this.setState({focused:!1,valid:i}),i&&a(e,o)}onChange(e){e.target.value.match(/^[\d-]*$/)&&this.setState({value:e.target.value})}render(){const{valid:e,focused:t,value:n}=this.state,{value:s,onValidityChange:a,...o}=this.props,i=t||!e?n:null!=(r=s)?r.toDateString():"";var r;return u().createElement("input",q({},o,{value:i,placeholder:t?"yyyy-mm-dd":null,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange}))}}class z extends u().Component{constructor(e){var t;super(e),this.state={value:(t=e.value,null!=t?t:"")},this.onBlur=this.onBlur.bind(this),this.onChange=this.onChange.bind(this)}onChange(e){this.setState({value:e.target.value})}onBlur(e){const{onChange:t}=this.props,{value:n}=this.state;var s;t(e,0===(s=n).trim().length?null:s)}render(){const{value:e}=this.state,{tag:t="input",...n}=this.props;return u().createElement(t,{...n,value:e,onBlur:this.onBlur,onChange:this.onChange})}}class J extends u().Component{static async fetchData(e,t,n){const{params:{id:s}}=e;return await O("query issue($id: Int!) {\n      issue(id: $id) {\n        id title status owner\n        effort created due description\n      }\n    }",{id:s},n)}constructor(){super();const e=P.initialData?P.initialData.issue:null;delete P.initialData,this.state={issue:e,invalidFields:{},showingValidation:!1},this.onChange=this.onChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.onValidityChange=this.onValidityChange.bind(this),this.dismissValidation=this.dismissValidation.bind(this),this.showValidation=this.showValidation.bind(this)}componentDidMount(){const{issue:e}=this.state;null==e&&this.loadData()}componentDidUpdate(e){const{match:{params:{id:t}}}=e,{match:{params:{id:n}}}=this.props;n!==t&&this.loadData()}onChange(e,t){const{name:n,value:s}=e.target,a=void 0===t?s:t;this.setState((e=>({issue:{...e.issue,[n]:a}})))}onValidityChange(e,t){const{name:n}=e.target;this.setState((e=>{const s={...e.invalidFields,[n]:!t};return t&&delete s[n],{invalidFields:s}}))}async handleSubmit(e){e.preventDefault(),this.showValidation();const{issue:t,invalidFields:n}=this.state;if(0!==Object.keys(n).length)return;const{id:s,created:a,...o}=t,{showSuccess:i,showError:r}=this.props,l=await O("mutation issueUpdate(\n      $id: Int!\n      $changes: IssueUpdateInputs!\n    ) {\n      issueUpdate(\n        id: $id\n        changes: $changes\n      ) {\n        id title status owner\n        effort created due description\n      }\n    }",{changes:o,id:s},r);l&&(this.setState({issue:l.issueUpdate}),i("Updated issue successfully"))}async loadData(){const{match:e,showError:t}=this.props,n=await J.fetchData(e,null,t);this.setState({issue:n?n.issue:{},invalidFields:{}})}showValidation(){this.setState({showingValidation:!0})}dismissValidation(){this.setState({showingValidation:!1})}render(){const{issue:e}=this.state;if(null==e)return null;const{issue:{id:t}}=this.state,{match:{params:{id:n}}}=this.props;if(null==t)return null!=n?u().createElement("h3",null,`Issue with ID ${n} not found.`):null;const{invalidFields:s,showingValidation:a}=this.state;let o;0!==Object.keys(s).length&&a&&(o=u().createElement(p.Alert,{bsStyle:"danger",onDismiss:this.dismissValidation},"Please correct invalid fields before submitting."));const{issue:{title:i,status:r}}=this.state,{issue:{owner:l,effort:c,description:h}}=this.state,{issue:{created:d,due:g}}=this.state,f=this.context;return u().createElement(p.Panel,null,u().createElement(p.Panel.Heading,null,u().createElement(p.Panel.Title,null,`Editing issue: ${t}`)),u().createElement(p.Panel.Body,null,u().createElement(p.Form,{horizontal:!0,onSubmit:this.handleSubmit},u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Created"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl.Static,null,d.toDateString()))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Status"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:"select",name:"status",value:r,onChange:this.onChange},u().createElement("option",{value:"New"},"New"),u().createElement("option",{value:"Assigned"},"Assigned"),u().createElement("option",{value:"Fixed"},"Fixed"),u().createElement("option",{value:"Closed"},"Closed")))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Owner"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:z,name:"owner",value:l,onChange:this.onChange,key:t}))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Effort"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:j,name:"effort",value:c,onChange:this.onChange,key:t}))),u().createElement(p.FormGroup,{validationState:s.due?"error":null},u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Due"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:H,onValidityChange:this.onValidityChange,name:"due",value:g,onChange:this.onChange,key:t}),u().createElement(p.FormControl.Feedback,null))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Title"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:z,size:50,name:"title",value:i,onChange:this.onChange,key:t}))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{componentClass:p.ControlLabel,sm:3},"Description"),u().createElement(p.Col,{sm:9},u().createElement(p.FormControl,{componentClass:z,tag:"textarea",rows:4,cols:50,name:"description",value:h,onChange:this.onChange,key:t}))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{smOffset:3,sm:6},u().createElement(p.ButtonToolbar,null,u().createElement(p.Button,{disabled:!f.signedIn,bsStyle:"primary",type:"submit"},"Submit"),u().createElement(E.LinkContainer,{to:"/issues"},u().createElement(p.Button,{bsStyle:"link"},"Back"))))),u().createElement(p.FormGroup,null,u().createElement(p.Col,{smOffset:3,sm:9},o)))),u().createElement(p.Panel.Footer,null,u().createElement(m.Link,{to:"/edit/"+(t-1)},"Prev")," | ",u().createElement(m.Link,{to:`/edit/${t+1}`},"Next")))}}const Y=_(J);Y.fetchData=J.fetchData,J.contextType=v;const W=Y;class X extends u().Component{static async fetchData(){return await O("query {about}")}constructor(e){super(e);const t=P.initialData?P.initialData.about:null;delete P.initialData,this.state={apiAbout:t}}async componentDidMount(){const{apiAbout:e}=this.state;if(null==e){const e=await X.fetchData();this.setState({apiAbout:e.about})}}render(){const{apiAbout:e}=this.state;return u().createElement("div",{className:"text-center"},u().createElement("h3",null,"Issue Tracker version 1"),u().createElement("h4",null,e))}}const K=[{path:"/issues/:id?",component:U},{path:"/edit/:id",component:W},{path:"/report",component:V},{path:"/about",component:X},{path:"*",component:function(){return u().createElement("h1",null,"Page Not Found")}}];function Q(){return Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Q.apply(this,arguments)}function Z(){return u().createElement(m.Switch,null,u().createElement(m.Redirect,{exact:!0,from:"/",to:"/issues"}),K.map((e=>u().createElement(m.Route,Q({},e,{key:e.path})))))}class ee extends u().Component{constructor(e){super(e),this.state={showing:!1},this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}showModal(){this.setState({showing:!0})}hideModal(){this.setState({showing:!1})}async handleSubmit(e){e.preventDefault(),this.hideModal();const t=document.forms.issueAdd,n={owner:t.owner.value,title:t.title.value,due:new Date((new Date).getTime()+864e6)},{showError:s}=this.props,a=await O("mutation issueAdd($issue: IssueInputs!) {\n      issueAdd(issue: $issue) {\n        id\n      }\n    }",{issue:n},s);if(a){const{history:e}=this.props;e.push(`/edit/${a.issueAdd.id}`)}}render(){const{showing:e}=this.state,{user:{signedIn:t}}=this.props;return u().createElement(u().Fragment,null,u().createElement(p.NavItem,{disabled:!t,onClick:this.showModal},u().createElement(p.OverlayTrigger,{placement:"left",delayShow:1e3,overlay:u().createElement(p.Tooltip,{id:"create-issue"},"Create Issue")},u().createElement(p.Glyphicon,{glyph:"plus"}))),u().createElement(p.Modal,{keyboard:!0,show:e,onHide:this.hideModal},u().createElement(p.Modal.Header,{closeButton:!0},u().createElement(p.Modal.Title,null,"Create Issue")),u().createElement(p.Modal.Body,null,u().createElement(p.Form,{name:"issueAdd"},u().createElement(p.FormGroup,null,u().createElement(p.ControlLabel,null,"Title"),u().createElement(p.FormControl,{name:"title",autoFocus:!0})),u().createElement(p.FormGroup,null,u().createElement(p.ControlLabel,null,"Owner"),u().createElement(p.FormControl,{name:"owner"})))),u().createElement(p.Modal.Footer,null,u().createElement(p.ButtonToolbar,null,u().createElement(p.Button,{type:"button",bsStyle:"primary",onClick:this.handleSubmit},"Submit"),u().createElement(p.Button,{bsStyle:"link",onClick:this.hideModal},"Cancel")))))}}const te=_((0,m.withRouter)(ee));class ne extends u().Component{constructor(e){super(e),this.state={showing:!1,disabled:!0},this.showModal=this.showModal.bind(this),this.hideModal=this.hideModal.bind(this),this.signOut=this.signOut.bind(this),this.signIn=this.signIn.bind(this)}componentDidMount(){const e=window.ENV.GOOGLE_CLIENT_ID;e&&window.gapi.load("auth2",(()=>{window.gapi.auth2.getAuthInstance()||window.gapi.auth2.init({client_id:e,scope:"email",plugin_name:"PLUGIN"}).then((()=>{this.setState({disabled:!1})}))}))}async signIn(){this.hideModal();const{showError:e}=this.props;let t;try{const e=window.gapi.auth2.getAuthInstance();t=(await e.signIn()).getAuthResponse().id_token}catch(t){e(`Error authenticating with Google: ${t.error}`)}try{const e=window.ENV.UI_AUTH_ENDPOINT,n=await fetch(`${e}/signin`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({google_token:t})}),s=await n.text(),a=JSON.parse(s),{signedIn:o,givenName:i}=a,{onUserChange:r}=this.props;r({signedIn:o,givenName:i})}catch(t){e(`Error signing into the app: ${t}`)}}async signOut(){const e=window.ENV.UI_AUTH_ENDPOINT,{showError:t}=this.props;try{await fetch(`${e}/signout`,{method:"POST",credentials:"include"});const t=window.gapi.auth2.getAuthInstance();await t.signOut();const{onUserChange:n}=this.props;n({signedIn:!1,givenName:""})}catch(e){t(`Error signing out: ${e}`)}}showModal(){const e=window.ENV.GOOGLE_CLIENT_ID,{showError:t}=this.props;e?this.setState({showing:!0}):t("Missing environment variable GOOGLE_CLIENT_ID")}hideModal(){this.setState({showing:!1})}render(){const{user:e}=this.props;if(e.signedIn)return u().createElement(p.NavDropdown,{title:e.givenName,id:"user"},u().createElement(p.MenuItem,{onClick:this.signOut},"Sign out"));const{showing:t,disabled:n}=this.state;return u().createElement(u().Fragment,null,u().createElement(p.NavItem,{onClick:this.showModal},"Sign in"),u().createElement(p.Modal,{keyboard:!0,show:t,onHide:this.hideModal,bsSize:"sm"},u().createElement(p.Modal.Header,{closeButton:!0},u().createElement(p.Modal.Title,null,"Sign in")),u().createElement(p.Modal.Body,null,u().createElement(p.Button,{block:!0,disabled:n,bsStyle:"primary",onClick:this.signIn},u().createElement("img",{src:"https://developers.google.com/identity/images/btn_google_signin_light_normal_web.png",alt:"Sign In"}))),u().createElement(p.Modal.Footer,null,u().createElement(p.Button,{bsStyle:"link",onClick:this.hideModal},"Cancel"))))}}const se=_(ne),ae=require("react-select/lib/Async");var oe=e.n(ae);class ie extends u().Component{constructor(e){super(e),this.onChangeSelection=this.onChangeSelection.bind(this),this.loadOptions=this.loadOptions.bind(this)}onChangeSelection({value:e}){const{history:t}=this.props;t.push(`/edit/${e}`)}async loadOptions(e){if(e.length<3)return[];const{showError:t}=this.props;return(await O("query issueList($search: String) {\n      issueList(search: $search) {\n        issues {id title}\n      }\n    }",{search:e},t)).issueList.issues.map((e=>({label:`#${e.id}: ${e.title}`,value:e.id})))}render(){return u().createElement(oe(),{instanceId:"search-select",value:"",loadOptions:this.loadOptions,filterOption:()=>!0,onChange:this.onChangeSelection,components:{DropdownIndicator:null}})}}const re=(0,m.withRouter)(_(ie));function le({user:e,onUserChange:t}){return u().createElement(p.Navbar,{fluid:!0},u().createElement(p.Navbar.Header,null,u().createElement(p.Navbar.Brand,null,"Issue Tracker")),u().createElement(p.Nav,null,u().createElement(E.LinkContainer,{exact:!0,to:"/"},u().createElement(p.NavItem,null,"Home")),u().createElement(E.LinkContainer,{to:"/issues"},u().createElement(p.NavItem,null,"Issue List")),u().createElement(E.LinkContainer,{to:"/report"},u().createElement(p.NavItem,null,"Report"))),u().createElement(p.Col,{sm:5},u().createElement(p.Navbar.Form,null,u().createElement(re,null))),u().createElement(p.Nav,{pullRight:!0},u().createElement(te,{user:e}),u().createElement(se,{user:e,onUserChange:t}),u().createElement(p.NavDropdown,{id:"user-dropdown",title:u().createElement(p.Glyphicon,{glyph:"asterisk"}),noCaret:!0},u().createElement(E.LinkContainer,{to:"/about"},u().createElement(p.MenuItem,null,"About")))))}function ce(){return u().createElement("small",null,u().createElement("hr",null),u().createElement("p",{className:"text-center"},u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"GitHub")," ",u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"Youtube")," ",u().createElement("a",{href:"/about"},"Youtube")),u().createElement("p",{className:"text-center"},"Designed and developed based on love and a passion for advancing React, helping it become popular worldwide by",u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"@PNT"),"and",u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"@VHNM"),".",u().createElement("br",null),"Maintained and repaired by",u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"@PNT"),"with support from",u().createElement("a",{href:"https://github.com/vasansr/pro-mern-stack-2"},"@VHNM"),". Code version v1.0."))}class ue extends u().Component{static async fetchData(e){return await O("query { user {\n      signedIn givenName\n    }}",null,null,e)}constructor(e){super(e);const t=P.userData?P.userData.user:null;delete P.userData,this.state={user:t},this.onUserChange=this.onUserChange.bind(this)}async componentDidMount(){const{user:e}=this.state;if(null==e){const e=await ue.fetchData();this.setState({user:e.user})}}onUserChange(e){this.setState({user:e})}render(){const{user:e}=this.state;return null==e?null:u().createElement("div",null,u().createElement(le,{user:e,onUserChange:this.onUserChange}),u().createElement(p.Grid,{fluid:!0},u().createElement(v.Provider,{value:e},u().createElement(Z,null))),u().createElement(ce,null))}}const he=require("serialize-javascript");var de=e.n(he);const me=a()();l().install(),n().config(),process.env.ENABLE_HMR,me.use(a().static("public"));const pe=process.env.API_PROXY_TARGET;pe&&(me.use("/graphql",i()({target:pe})),me.use("/auth",i()({target:pe}))),process.env.UI_API_ENDPOINT||(process.env.UI_API_ENDPOINT="http://localhost:3000/graphql"),process.env.UI_SERVER_API_ENDPOINT||(process.env.UI_SERVER_API_ENDPOINT=process.env.UI_API_ENDPOINT),process.env.UI_AUTH_ENDPOINT||(process.env.UI_AUTH_ENDPOINT="http://localhost:3000/auth"),me.get("/env.js",((e,t)=>{const n={UI_API_ENDPOINT:process.env.UI_API_ENDPOINT,UI_AUTH_ENDPOINT:process.env.UI_AUTH_ENDPOINT,GOOGLE_CLIENT_ID:process.env.GOOGLE_CLIENT_ID};t.send(`window.ENV = ${JSON.stringify(n)}`)})),me.get("*",((e,t,n)=>{!async function(e,t){const n=K.find((t=>(0,m.matchPath)(e.path,t)));let s;if(n&&n.component.fetchData){const t=(0,m.matchPath)(e.path,n),a=e.url.indexOf("?"),o=-1!==a?e.url.substr(a):null;s=await n.component.fetchData(t,o,e.headers.cookie)}const a=await ue.fetchData(e.headers.cookie);P.initialData=s,P.userData=a;const o={},i=u().createElement(m.StaticRouter,{location:e.url,context:o},u().createElement(ue,null)),r=d().renderToString(i);o.url?t.redirect(301,o.url):t.send(function(e,t,n){return`<!DOCTYPE HTML>\n<html>\n\n<head>\n  <meta charset="utf-8">\n  <title>Pro MERN Stack</title>\n  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" >\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n\n  <script src="https://apis.google.com/js/api:client.js"><\/script>\n\n  <style>\n    table.table-hover tr {cursor: pointer;}\n    .panel-title a {display: block; width: 100%; cursor: pointer;}\n  </style>\n</head>\n\n<body>\n  \x3c!-- Page generated from template. --\x3e\n  <div id="contents">${e}</div>\n  <script>\n    window.__INITIAL_DATA__ = ${de()(t)}\n    window.__USER_DATA__ = ${de()(n)}\n  <\/script>\n\n  <script src="/env.js"><\/script>\n  <script src="/vendor.bundle.js"><\/script>\n  <script src="/app.bundle.js"><\/script>\n</body>\n\n</html>\n`}(r,s,a))}(e,t)}));const Ee=process.env.UI_SERVER_PORT||8e3;me.listen(Ee,(()=>{console.log(`UI started on port ${Ee}`)}))})();
//# sourceMappingURL=server.js.map